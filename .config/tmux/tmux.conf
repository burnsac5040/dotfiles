# -- Plugins -------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin "roy2220/easyjump.tmux"

TMUX_FZF_LAUNCH_KEY="C-f"
set -g @tpm-clean "C-u"

# -- Keybindings ---------------------------------------------------------------
# c-d = close pane
# pref - r = source tmux
# pref - I = install plugin
# pref - U = update plugin
# pref - c-f = tmux-fzf
# pref - s = bmux
# pref - x = kill pane
# pref - & = kill window
# pref - ) = switch sessions
# pref - ( = switch sessions
# pref - e = switch between synchronize
# pref - v = throw pane into current pane
# pref - h = throw pane into current pane
# pref - q = swap pane with selected pane
# pref - Q = swap pane with selected pane
# pref - - = split horizontally
# pref - | = split vertically
# pref - HJKL = resize

# -- Base16 --------------------------------------------------------------------

# base 16 colors with nord mix onedark palatees
base00=default   # - Black, Default background color
base01='#3b4252' # - Black, lighter, pane number
base02='#434c5e' # - Black, lighter, pane border
base03='#abb2bf' # - Black, greyish, window title
base04='#d8dee9' # - White
base05='#e5e9f0' # - White, lighter
base06='#eceff4' # - White, lighter
base07='#56b6c2' # - Light Green, status date
base08='#88c0d0' # - Light Blue, clock, active pane number
base09='#61afef' # - Sky Blue, status battery
base0A='#5e81ac' # - Dark Blue
base0B='#e06c75' # - Red, status prefix highlight
base0C='#d08770' # - Orange, tmux message
base0D='#e5c07b' # - yellow, active window, status zoom
base0E='#98c379' # - Green, status prefix off
base0F='#c678dd' # - Purple, active border, session

# -- Colors --------------------------------------------------------------------

# true color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -g display-panes-active-colour $base08
set -g display-panes-colour $base01

# pane border colors
setw -g pane-active-border-style fg=$base09
setw -g pane-border-style fg=$base02
setw -g clock-mode-colour $base08

# pane number display
set-option -g display-panes-active-colour $base08
set-option -g display-panes-colour $base01

# clock style
set-window-option -g clock-mode-colour $base08

# -- Status Bar ----------------------------------------------------------------

# status bar general styles
set -g status 'on'
set -g status-left-length 30
set -g status-right-length 150
set -g status-style fg=$base02,bg=$base00,default
set -g message-style bg=$base00,fg=$base0C

# prefix config
set -g @prefix_highlight_empty_prompt ' ﬿ '
set -g @prefix_highlight_empty_attr fg=$base0E,bg=$base00
set -g @prefix_highlight_prefix_prompt '﬿'
set -g @prefix_highlight_fg $base0B
set -g @prefix_highlight_bg $base00
set -g @prefix_highlight_copy_prompt '﬿'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr fg=$base0D,bg=$base00
set -g @prefix_highlight_sync_prompt '﬿'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_sync_mode_attr fg=$base0A,bg=$base00

setw -g window-status-style fg=$base03,bg=$base00
setw -g window-status-format " #I #W"
setw -g window-status-current-style fg=$base0D,bg=$base00
setw -g window-status-current-format " #[bold]#W"

# left status
tm_session_name="#[default,bg=$base00,fg=$base0F]  #S "
set -g status-left "$tm_session_name"

# right status
tm_cpu=" #($HOME/mybin/tmux/cpu)"
tm_mem=" #($HOME/mybin/tmux/mem)"
tm_prefix="#{prefix_highlight}"
tm_zoom="#[default,bg=$base00,fg=$base0D] #{?window_zoomed_flag,,}"
tm_upTime="#[default,fg=$base09,bg=$base00] #($HOME/mybin/tmux/osx_pretty_time)"
tm_pane="#[default,bg=$base00, fg=$base0F]  #P"
set -g status-right "$tm_pane $tm_upTime $tm_mem $tm_cpu $tm_zoom $tm_prefix"

# -- General -------------------------------------------------------------------

# start window and pane numbering from 1
set -g base-index 1
# renumber windows on close
set -g renumber-windows on
# status refersh 5sec
set -g status-interval 5
# vim esc time
set -s escape-time 20
# increase scrollback buffer size
set -g history-limit 10000
# tmux messages are displayed for 4 seconds
set -g display-time 4000
# don't rename windows automatically
set -g allow-rename off
# increase repeat time (interval to repeat commands after prefix with -r flag)
set -g repeat-time 1500
set -g set-clipboard on
set -g mouse on

# -- Keybinds ------------------------------------------------------------------
set -q -g status-utf8 on
setw -g aggressive-resize on
setw -g pane-base-index 1

# remap prefix from 'C-b' to 'C-a'
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# provide a way to clear screen after C-l is taken
bind C-l send-keys 'C-l'
# is bound to a zsh binding
bind C-k send-keys 'C-k'

# maximize current pane
bind + run 'cut -c3- ~/.config/tmux/tmux.conf | sh -s _maximize_pane "#{session_name}" #D'

# resize
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# bind-key -n C-h if-shell $tmux__is_vim "send-keys C-h"  "select-pane -L"
# bind-key -n C-j if-shell $tmux__is_vim "send-keys C-j"  "select-pane -D"
# bind-key -n C-k if-shell $tmux__is_vim "send-keys C-k"  "select-pane -U"
# bind-key -n C-l if-shell $tmux__is_vim "send-keys C-l"  "select-pane -R"

# split panes using | and - (with same profile path)
bind |   split-window -h -c "#{pane_current_path}"
bind -   split-window -v -c "#{pane_current_path}"
bind c   new-window      -c '#{pane_current_path}'
unbind '"'
unbind %

# switch between sessions
bind -r ( switch-client -p
bind -r ) switch-client -n

bind "{" swap-window  -t -1
bind "}" swap-window  -t +1
bind [   swap-pane    -U
bind ]   swap-pane    -D

# switch between synchronize all pane
bind e setw synchronize-panes

# throw a pane into current pane from another window
bind v choose-window "join-pane -v -s "%%""
bind h choose-window "join-pane -h -s "%%""

# kill without confirm
bind-key x kill-pane
bind-key & kill-window
# kill all sessions
bind-key X kill-session -a
# send pane to background and not kill it
bind-key C-x break-pane -dP
# join-pane -vs session:window.pane

# swap current pane with the selected pane
bind q display-panes "swap-pane -t "%%""
bind Q display-panes

# reload config file directly using prefix r
bind r source-file ~/.config/tmux/tmux.conf \; run -b "terminal-notifier -message 'config sourced' -title 'tmux'"

# bmux
bind s display-popup -E bmux -a

# fix mouse
unbind -T root MouseDrag1Pane
unbind -T copy-mode-vi MouseDragEnd1Pane
bind -T copy-mode-vi MouseDown1Pane select-pane\; send-keys -X clear-selection

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

# surfraw
bind-key -n 'C-\' new-window -n bookmarks -c $HOME \; \
    send-keys 'fsr && tmux kill-window' 'Enter'

# neomutt
bind-key M-e new-window -n email -c $HOME \; \
  send-keys -t email 'neomutt' 'Enter' \; \

# newsboat
bind-key M-r new-window -n rss -c $HOME \; \
  send-keys -t rss 'newsboat' 'Enter'

# task spooler
bind-key M-s new-window -n spool -c $HOME \; \
  send-keys -t spool 'tsp -C && watch tsp' 'Enter' \; \
  split-window -t spool -v \; \
  send-keys -t spool 'TS_SOCKET=/tmp/fm tsp -C && watch TS_SOCKET=/tmp/fm tsp' 'Enter' \; \
  split-window -t spool -v -p 10


# -- Source --------------------------------------------------------------------
run -b '~/.tmux/plugins/tpm/tpm'
# vim: ft=tmux:et:sw=0:ts=2:sts=2:
